<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel Validator — SEKN</title>

    <!-- Font: Plus Jakarta Sans -->
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              jakarta: ['"Plus Jakarta Sans"', "sans-serif"],
            },
          },
        },
      };
    </script>

    <style>
      #toast {
        transition: opacity 0.3s ease;
      }
      .tab-active {
        background-color: #b06a3c;
        color: #ffffff;
      }
    </style>
  </head>
  <body class="bg-[#f7f3ee] text-[#2b251f] font-jakarta">
    <!-- Header -->
    <header class="bg-[#fffaf3] shadow sticky top-0 z-50">
      <div
        class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"
      >
        <h1 class="text-xl font-bold">SEKN</h1>
        <nav class="space-x-4 flex items-center">
          <!-- Switch role (sekadar navigasi antar prototipe) -->
          <a
            href="../index.html"
            class="text-[#3d2a22] font-semibold hover:underline"
            >Pembeli</a
          >
          <a
            href="../penjual/index.html"
            class="text-[#3d2a22] font-semibold hover:underline"
            >Penjual</a
          >
          <a href="index.html" class="text-[#b06a3c] font-semibold underline"
            >Validator</a
          >
          <span id="authArea" class="ml-4"></span>
        </nav>
      </div>
    </header>

    <!-- Hero / Intro -->
    <section
      class="bg-gradient-to-br from-[#fffaf3] to-[#f7f3ee] border-b border-[#e0d6cc]"
    >
      <div
        class="max-w-7xl mx-auto px-4 py-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"
      >
        <div>
          <p
            class="text-xs uppercase tracking-wide text-[#b06a3c] font-semibold mb-1"
          >
            Panel Validator
          </p>
          <h2 class="text-2xl sm:text-3xl font-bold text-[#3d2a22] mb-2">
            Daftar Gadget yang Perlu Dicek
          </h2>
          <p class="text-sm text-[#6b5f55] max-w-xl">
            Pantau antrian inspeksi, update status pengecekan, dan lanjut ke
            halaman laporan & badge resmi.
          </p>
        </div>
        <div class="grid grid-cols-3 gap-3 sm:w-72">
          <div class="bg-[#fffaf3] rounded-xl shadow px-3 py-2 text-center">
            <p class="text-[11px] text-[#6b5f55]">Total Task</p>
            <p id="statTotal" class="text-lg font-bold text-[#3d2a22]">0</p>
          </div>
          <div class="bg-[#fffaf3] rounded-xl shadow px-3 py-2 text-center">
            <p class="text-[11px] text-[#6b5f55]">Menunggu</p>
            <p id="statPending" class="text-lg font-bold text-[#b06a3c]">0</p>
          </div>
          <div class="bg-[#fffaf3] rounded-xl shadow px-3 py-2 text-center">
            <p class="text-[11px] text-[#6b5f55]">Selesai</p>
            <p id="statDone" class="text-lg font-bold text-green-600">0</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Main -->
    <main class="max-w-7xl mx-auto px-4 py-8">
      <!-- Filter Tabs -->
      <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
        <div class="flex gap-2 text-sm">
          <button
            data-filter="all"
            class="filter-tab tab-active px-3 py-1.5 rounded-full border border-[#e0d6cc] font-semibold"
          >
            Semua
          </button>
          <button
            data-filter="menunggu"
            class="filter-tab px-3 py-1.5 rounded-full border border-[#e0d6cc] font-semibold"
          >
            Menunggu
          </button>
          <button
            data-filter="proses"
            class="filter-tab px-3 py-1.5 rounded-full border border-[#e0d6cc] font-semibold"
          >
            Sedang Dicek
          </button>
          <button
            data-filter="selesai"
            class="filter-tab px-3 py-1.5 rounded-full border border-[#e0d6cc] font-semibold"
          >
            Selesai
          </button>
        </div>
        <p class="text-xs sm:text-sm text-[#6b5f55]">
          *Data dummy untuk simulasi alur verifikasi di mitra servis.
        </p>
      </div>

      <!-- List Inspeksi -->
      <section
        id="inspeksiList"
        class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"
      >
        <!-- card akan di-render via JS -->
      </section>
    </main>

    <!-- Footer -->
    <footer
      class="text-center text-sm text-[#6b5f55] py-6 border-t border-[#e0d6cc]"
    >
      © 2025 SEKN Prototype — Biar Bekas Tetap Berkelas
    </footer>

    <!-- Toast -->
    <div
      id="toast"
      class="fixed bottom-6 right-6 bg-[#2b251f] text-white text-sm px-4 py-2 rounded-md shadow-lg hidden z-50"
    >
      Tersimpan.
    </div>

    <!-- Script -->
    <script>
      // -----------------------
      // DATA DUMMY INSPEKSI
      // -----------------------
      const defaultInspeksi = [
        {
          id: "iphone12",
          produk: "iPhone 12 128GB",
          gambar:
            "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=600",
          mitra: "Aman Cell — Surabaya",
          gradeSementara: "A (perkiraan)",
          status: "menunggu",
          risiko: "Tinggi",
          sla: "Selesai < 2 jam",
          badge: false,
        },
        {
          id: "galaxyS21",
          produk: "Samsung Galaxy S21",
          gambar:
            "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6441/6441108_sd.jpg",
          mitra: "Servisindo Mobile — Jakarta",
          gradeSementara: "B (perkiraan)",
          status: "proses",
          risiko: "Sedang",
          sla: "Selesai hari ini",
          badge: false,
        },
        {
          id: "redmi10",
          produk: "Xiaomi Redmi Note 10",
          gambar:
            "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRoCMtJIoWSrxGGEdbPjCylgSN4PmHKnA0tSA&s",
          mitra: "GadgetCare — Bandung",
          gradeSementara: "C (perkiraan)",
          status: "menunggu",
          risiko: "Sedang",
          sla: "Selesai < 4 jam",
          badge: false,
        },
        {
          id: "iphone11",
          produk: "iPhone 11 64GB",
          gambar:
            "https://images.unsplash.com/photo-1510557880182-3d4d3cba35a5?q=80&w=600",
          mitra: "iFix Mobile — Surabaya",
          gradeSementara: "B (perkiraan)",
          status: "proses",
          risiko: "Rendah",
          sla: "Follow-up kamera",
          badge: true,
        },
        {
          id: "realme8",
          produk: "Realme 8",
          gambar:
            "https://images.unsplash.com/photo-1512491303613-9769b480c9c0?q=80&w=600",
          mitra: "TechLab — Jakarta",
          gradeSementara: "B (perkiraan)",
          status: "selesai",
          risiko: "Rendah",
          sla: "Sudah selesai",
          badge: true,
        },
      ];

      let inspeksiData =
        JSON.parse(localStorage.getItem("sekn_inspeksiData") || "null") ||
        defaultInspeksi;
      let currentFilter = "all";

      // -----------------------
      // RENDER CARD INSPEKSI
      // -----------------------
      function getStatusLabel(status) {
        if (status === "menunggu")
          return { text: "Menunggu", class: "bg-yellow-100 text-yellow-800" };
        if (status === "proses")
          return { text: "Sedang dicek", class: "bg-blue-100 text-blue-800" };
        return { text: "Selesai", class: "bg-green-100 text-green-800" };
      }

      function getRiskLabel(risiko) {
        if (risiko === "Tinggi")
          return { class: "text-red-600", dot: "bg-red-500" };
        if (risiko === "Sedang")
          return { class: "text-[#b06a3c]", dot: "bg-[#b06a3c]" };
        return { class: "text-green-600", dot: "bg-green-500" };
      }

      function renderInspeksi() {
        const container = document.getElementById("inspeksiList");
        container.innerHTML = "";

        const filtered = inspeksiData.filter((item) => {
          if (currentFilter === "all") return true;
          return item.status === currentFilter;
        });

        if (filtered.length === 0) {
          container.innerHTML = `
          <div class="col-span-full bg-[#fffaf3] border border-dashed border-[#e0d6cc] rounded-xl p-6 text-center text-sm text-[#6b5f55]">
            Belum ada task inspeksi untuk filter ini.
          </div>
        `;
          renderStats();
          return;
        }

        filtered.forEach((item) => {
          const statusInfo = getStatusLabel(item.status);
          const riskInfo = getRiskLabel(item.risiko);

          const badgeText = item.badge
            ? "Badge resmi sudah terbit"
            : "Belum ada badge resmi";
          const badgeClass = item.badge
            ? "bg-green-50 text-green-700 border border-green-100"
            : "bg-[#fffaf3] text-[#6b5f55] border border-[#e0d6cc]";

          container.innerHTML += `
          <article class="bg-[#fffaf3] rounded-xl shadow hover:shadow-lg transition flex flex-col">
            <img src="${item.gambar}" alt="${
            item.produk
          }" class="w-full h-40 object-cover rounded-t-xl">
            <div class="p-4 flex flex-col flex-1">
              <div class="flex items-start justify-between gap-2 mb-2">
                <h3 class="text-base font-semibold text-[#3d2a22]">${
                  item.produk
                }</h3>
                <span class="text-[11px] px-2 py-1 rounded-full ${
                  statusInfo.class
                }">
                  ${statusInfo.text}
                </span>
              </div>

              <p class="text-xs text-[#6b5f55] mb-1">
                Mitra verifikasi: <span class="font-semibold text-[#3d2a22]">${
                  item.mitra
                }</span>
              </p>
              <p class="text-xs text-[#6b5f55] mb-2">
                Estimasi grade: <span class="font-semibold">${
                  item.gradeSementara
                }</span>
              </p>

              <div class="flex items-center justify-between text-xs mb-3">
                <div class="flex items-center gap-1 ${riskInfo.class}">
                  <span class="inline-block w-2 h-2 rounded-full ${
                    riskInfo.dot
                  }"></span>
                  <span>Risiko kasus: ${item.risiko}</span>
                </div>
                <span class="text-[11px] text-[#6b5f55] italic">
                  ${item.sla}
                </span>
              </div>

              <div class="text-[11px] rounded-lg px-3 py-2 mb-3 ${badgeClass}">
                ${badgeText}
              </div>

              <div class="mt-auto grid grid-cols-1 gap-2 text-sm">
                <a href="report.html?id=${item.id}"
                   class="text-center bg-[#b06a3c] text-white font-semibold py-2 rounded-md hover:bg-[#a05d2f]">
                  Isi / Lihat Laporan
                </a>
                <div class="flex gap-2">
                  <a href="badge.html?id=${item.id}"
                     class="flex-1 text-center bg-white border border-[#b06a3c] text-[#b06a3c] font-semibold py-2 rounded-md hover:bg-[#fef7f2]">
                    Kelola Badge
                  </a>
                  ${
                    item.status !== "selesai"
                      ? `
                  <button
                    data-action="done"
                    data-id="${item.id}"
                    class="flex-1 text-center bg-[#2b251f] text-white font-semibold py-2 rounded-md hover:bg-black">
                    Tandai Selesai
                  </button>`
                      : `
                  <button
                    data-action="reopen"
                    data-id="${item.id}"
                    class="flex-1 text-center bg-white border border-[#2b251f] text-[#2b251f] font-semibold py-2 rounded-md hover:bg-[#f1ece6]">
                    Buka Lagi
                  </button>`
                  }
                </div>
              </div>
            </div>
          </article>
        `;
        });

        attachCardHandlers();
        renderStats();
      }

      // -----------------------
      // STAT KECIL DI HERO
      // -----------------------
      function renderStats() {
        const total = inspeksiData.length;
        const pending = inspeksiData.filter(
          (i) => i.status === "menunggu"
        ).length;
        const done = inspeksiData.filter((i) => i.status === "selesai").length;

        document.getElementById("statTotal").textContent = total;
        document.getElementById("statPending").textContent = pending;
        document.getElementById("statDone").textContent = done;
      }

      // -----------------------
      // HANDLER BUTTON DI CARD
      // -----------------------
      function attachCardHandlers() {
        document.querySelectorAll("[data-action='done']").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            updateStatus(id, "selesai");
            showToast("Task ditandai selesai.");
          });
        });

        document.querySelectorAll("[data-action='reopen']").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            updateStatus(id, "menunggu");
            showToast("Task dibuka kembali.");
          });
        });
      }

      function updateStatus(id, statusBaru) {
        inspeksiData = inspeksiData.map((item) =>
          item.id === id ? { ...item, status: statusBaru } : item
        );
        localStorage.setItem("sekn_inspeksiData", JSON.stringify(inspeksiData));
        renderInspeksi();
      }

      // -----------------------
      // FILTER TABS
      // -----------------------
      document.querySelectorAll(".filter-tab").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".filter-tab")
            .forEach((b) => b.classList.remove("tab-active"));
          btn.classList.add("tab-active");
          currentFilter = btn.getAttribute("data-filter");
          renderInspeksi();
        });
      });

      // -----------------------
      // TOAST
      // -----------------------
      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.remove("hidden");
        toast.classList.add("opacity-100");
        setTimeout(() => {
          toast.classList.add("hidden");
        }, 2500);
      }

      // -----------------------
      // LOGIN UI (SHARED)
      // -----------------------
      const user = JSON.parse(localStorage.getItem("user"));
      const authArea = document.getElementById("authArea");

      if (user) {
        authArea.innerHTML = `
        <span class="text-[#3d2a22] font-semibold">Hi, ${user.nama}</span>
        <button onclick="logout()" class="text-[#b06a3c] underline ml-2">Logout</button>
      `;
      } else {
        authArea.innerHTML = `<a href="../login.html" class="text-[#b06a3c] underline">Login</a>`;
      }

      function logout() {
        localStorage.removeItem("user");
        window.location.href = "../login.html";
      }

      // Inisialisasi awal
      renderInspeksi();
    </script>
  </body>
</html>
