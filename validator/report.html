<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Laporan Inspeksi — SEKN</title>

    <!-- Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              jakarta: ['"Plus Jakarta Sans"', "sans-serif"],
            },
          },
        },
      };
    </script>

    <style>
      #toast {
        transition: opacity 0.3s ease;
      }
      .badge-pill {
        border-radius: 999px;
      }
    </style>
  </head>
  <body class="bg-[#f7f3ee] text-[#2b251f] font-jakarta">
    <!-- Header -->
    <header class="bg-[#fffaf3] shadow sticky top-0 z-50">
      <div
        class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"
      >
        <h1 class="text-xl font-bold">SEKN</h1>
        <nav class="space-x-4 flex items-center">
          <a
            href="../index.html"
            class="text-[#3d2a22] font-semibold hover:underline"
            >Pembeli</a
          >
          <a
            href="../penjual/index.html"
            class="text-[#3d2a22] font-semibold hover:underline"
            >Penjual</a
          >
          <a href="index.html" class="text-[#b06a3c] font-semibold underline"
            >Validator</a
          >
          <span id="authArea" class="ml-4"></span>
        </nav>
      </div>
    </header>

    <!-- Hero / Breadcrumb -->
    <section
      class="bg-gradient-to-br from-[#fffaf3] to-[#f7f3ee] border-b border-[#e0d6cc]"
    >
      <div class="max-w-5xl mx-auto px-4 py-8">
        <p class="text-xs text-[#6b5f55] mb-2">
          <a href="index.html" class="hover:underline text-[#3d2a22]"
            >Panel Validator</a
          >
          <span class="mx-1">/</span>
          <span class="text-[#b06a3c] font-semibold">Laporan Inspeksi</span>
        </p>
        <h2
          id="reportTitle"
          class="text-2xl sm:text-3xl font-bold text-[#3d2a22] mb-2"
        >
          Laporan Inspeksi
        </h2>
        <p class="text-sm text-[#6b5f55] max-w-xl" id="reportSubtitle">
          Ringkasan hasil pengecekan perangkat oleh mitra verifikasi SEKN.
        </p>
      </div>
    </section>

    <!-- Main -->
    <main class="max-w-5xl mx-auto px-4 py-8" id="reportContainer">
      <!-- Isi laporan akan diisi via JavaScript -->
    </main>

    <!-- Footer -->
    <footer
      class="text-center text-sm text-[#6b5f55] py-6 border-t border-[#e0d6cc]"
    >
      © 2025 SEKN Prototype — Biar Bekas Tetap Berkelas
    </footer>

    <!-- Toast (opsional, kalau mau dipakai nanti) -->
    <div
      id="toast"
      class="fixed bottom-6 right-6 bg-[#2b251f] text-white text-sm px-4 py-2 rounded-md shadow-lg hidden z-50"
    >
      Tersimpan.
    </div>

    <!-- Script -->
    <script>
      // ========= DATA DUMMY (STÁTIS) =========

      // Data dasar task inspeksi (disamakan sama index validator)
      const defaultInspeksi = [
        {
          id: "iphone12",
          produk: "iPhone 12 128GB",
          gambar:
            "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=600",
          mitra: "Aman Cell — Surabaya",
          gradeSementara: "A (perkiraan)",
          status: "menunggu",
          risiko: "Tinggi",
          sla: "Selesai < 2 jam",
          badge: false,
        },
        {
          id: "galaxyS21",
          produk: "Samsung Galaxy S21",
          gambar:
            "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6441/6441108_sd.jpg",
          mitra: "Servisindo Mobile — Jakarta",
          gradeSementara: "B (perkiraan)",
          status: "proses",
          risiko: "Sedang",
          sla: "Selesai hari ini",
          badge: false,
        },
        {
          id: "redmi10",
          produk: "Xiaomi Redmi Note 10",
          gambar:
            "https://i01.appmifile.com/webfile/globalimg/products/pc/redmi-note-10/gallery01.png",
          mitra: "GadgetCare — Bandung",
          gradeSementara: "C (perkiraan)",
          status: "menunggu",
          risiko: "Sedang",
          sla: "Selesai < 4 jam",
          badge: false,
        },
        {
          id: "iphone11",
          produk: "iPhone 11 64GB",
          gambar:
            "https://images.unsplash.com/photo-1510557880182-3d4d3cba35a5?q=80&w=600",
          mitra: "iFix Mobile — Surabaya",
          gradeSementara: "B (perkiraan)",
          status: "proses",
          risiko: "Rendah",
          sla: "Follow-up kamera",
          badge: true,
        },
        {
          id: "realme8",
          produk: "Realme 8",
          gambar:
            "https://images.unsplash.com/photo-1512491303613-9769b480c9c0?q=80&w=600",
          mitra: "TechLab — Jakarta",
          gradeSementara: "B (perkiraan)",
          status: "selesai",
          risiko: "Rendah",
          sla: "Sudah selesai",
          badge: true,
        },
      ];

      // Detail laporan per-produk (dummy, purely frontend)
      const laporanDetail = {
        iphone12: {
          nomorLaporan: "SEKN-INS-2025-0012",
          tanggal: "10 Maret 2025, 14:22 WIB",
          penjual: "ID Penjual #P-1023 — Johan Store",
          catatanUmum:
            "Perangkat dalam kondisi sangat baik, hanya ditemukan gores halus di sisi frame kanan.",
          gradeFinal: "A",
          rekomendasi:
            "Layak dijual sebagai perangkat Grade A dengan garansi toko & SEKN 30 hari.",
          checklistFisik: [
            [
              "Layar",
              "Tidak retak, sedikit micro-scratch sangat halus.",
              "success",
            ],
            [
              "Frame & Body",
              "Ada gores halus di sisi kanan, tidak mengganggu estetika keseluruhan.",
              "warning",
            ],
            [
              "Kamera Depan & Belakang",
              "Lensa bersih, fokus cepat, tidak ada spot.",
              "success",
            ],
            [
              "Port & Slot (Charging, SIM)",
              "Tidak berkarat, berfungsi normal.",
              "success",
            ],
            ["Backdoor / Tutup Belakang", "Rapat, tidak ada celah.", "success"],
          ],
          checklistFungsi: [
            ["Layar Sentuh", "Responsif di seluruh sisi.", "success"],
            ["Speaker & Mic", "Suara jernih, tidak ada noise.", "success"],
            ["Face ID / Biometrik", "Berfungsi normal.", "success"],
            [
              "Konektivitas (Wi-Fi, 4G, Bluetooth)",
              "Semua terhubung dengan normal.",
              "success",
            ],
            [
              "Baterai",
              "Health 85%, tidak ditemukan gejala drop parah.",
              "success",
            ],
          ],
          dokumentasi: [
            "Tampak Depan — kondisi layar",
            "Tampak Belakang — kondisi body",
            "Sisi Kanan — gores halus",
            "Menu Baterai — health 85%",
          ],
          catatanTambahan:
            "Disarankan menyertakan foto close-up sisi kanan pada listing agar ekspektasi pembeli jelas.",
        },
        galaxyS21: {
          nomorLaporan: "SEKN-INS-2025-0045",
          tanggal: "11 Maret 2025, 10:05 WIB",
          penjual: "ID Penjual #P-1089 — Gadget House",
          catatanUmum:
            "Perangkat normal dengan bekas pakai ringan, layar terdapat gores halus yang hanya terlihat di kondisi cahaya tertentu.",
          gradeFinal: "B",
          rekomendasi:
            "Layak dijual sebagai perangkat Grade B dengan deskripsi bekas pakai ringan.",
          checklistFisik: [
            [
              "Layar",
              "Gores halus terlihat di sudut kiri bila pantulan cahaya tertentu.",
              "warning",
            ],
            [
              "Frame & Body",
              "Sedikit dent kecil di sudut bawah, kosmetik saja.",
              "warning",
            ],
            [
              "Kamera",
              "Tidak ada gores pada lensa, hasil foto tajam.",
              "success",
            ],
            ["Port & Slot", "Normal, tidak ditemukan karat.", "success"],
            ["Backdoor", "Ada hairline scratch, tidak mengelupas.", "warning"],
          ],
          checklistFungsi: [
            ["Layar Sentuh", "Responsif, tidak ada dead touch.", "success"],
            ["Speaker & Mic", "Sedikit noise di volume maksimal.", "warning"],
            [
              "Biometrik",
              "Fingerprint berfungsi normal (Face ID tidak tersedia).",
              "success",
            ],
            [
              "Konektivitas",
              "Wi-Fi, data seluler, dan Bluetooth normal.",
              "success",
            ],
            [
              "Baterai",
              "Health sekitar 80%, wajar untuk usia pakai 3 tahun.",
              "success",
            ],
          ],
          dokumentasi: [
            "Layar — gores halus dekat notch",
            "Sisi Bawah — dent kecil",
            "Hasil Foto — uji kamera",
            "Menu Baterai — indikasi pemakaian",
          ],
          catatanTambahan:
            "Cantumkan catatan kecil terkait gores layar dan dent bawah agar transparan ke calon pembeli.",
        },
        redmi10: {
          nomorLaporan: "SEKN-INS-2025-0060",
          tanggal: "11 Maret 2025, 16:40 WIB",
          penjual: "ID Penjual #P-1150 — Bandung Gadget Corner",
          catatanUmum:
            "Perangkat masih berfungsi namun kondisi kosmetik dan beberapa fungsi berada di level cukup.",
          gradeFinal: "C",
          rekomendasi:
            "Masih layak dijual dengan harga miring sebagai perangkat Grade C. Wajib mencantumkan semua kekurangan.",
          checklistFisik: [
            [
              "Layar",
              "Sedikit shadow di pojok kanan, masih bisa dipakai harian.",
              "warning",
            ],
            [
              "Frame & Body",
              "Lecet sedang di bagian belakang dan sudut.",
              "danger",
            ],
            ["Kamera", "Lensa bersih, hasil foto standar.", "success"],
            [
              "Port & Slot",
              "Charging port normal, ada sedikit debu.",
              "success",
            ],
            ["Backdoor", "Terlihat bekas jatuh di sudut bawah.", "danger"],
          ],
          checklistFungsi: [
            ["Layar Sentuh", "Masih responsif.", "success"],
            [
              "Speaker & Mic",
              "Mic terdengar sedikit kecil di lawan bicara.",
              "warning",
            ],
            ["Konektivitas", "Normal, tidak ada kendala berarti.", "success"],
            [
              "Baterai",
              "Health sekitar 78%, agak cepat turun saat gaming.",
              "warning",
            ],
            ["Sensor (gyroscope, proximity)", "Normal.", "success"],
          ],
          dokumentasi: [
            "Shadow layar — pojok kanan",
            "Lecet body belakang",
            "Tes telepon — volume mic",
            "Menu Baterai — estimasi pemakaian",
          ],
          catatanTambahan:
            "Sebaiknya diposisikan untuk segmen pengguna yang mencari HP cadangan atau kebutuhan dasar.",
        },
      };

      // ========= HELPER UI =========

      function getStatusLabel(status) {
        if (status === "menunggu")
          return {
            text: "Menunggu inspeksi",
            class: "bg-yellow-100 text-yellow-800",
          };
        if (status === "proses")
          return { text: "Sedang dicek", class: "bg-blue-100 text-blue-800" };
        return { text: "Selesai", class: "bg-green-100 text-green-800" };
      }

      function getRiskLabel(risiko) {
        if (risiko === "Tinggi")
          return {
            text: "Risiko kasus tinggi",
            dot: "bg-red-500",
            class: "text-red-600",
          };
        if (risiko === "Sedang")
          return {
            text: "Risiko kasus sedang",
            dot: "bg-[#b06a3c]",
            class: "text-[#b06a3c]",
          };
        return {
          text: "Risiko kasus rendah",
          dot: "bg-green-500",
          class: "text-green-600",
        };
      }

      function renderChecklist(list) {
        return list
          .map(([judul, deskripsi, status]) => {
            const icon =
              status === "success" ? "✅" : status === "warning" ? "⚠️" : "❌";
            const color =
              status === "success"
                ? "text-green-600"
                : status === "warning"
                ? "text-yellow-500"
                : "text-red-600";
            return `
          <div class="flex items-start gap-3 bg-white rounded-lg shadow p-3">
            <div class="${color} text-xl">${icon}</div>
            <div>
              <div class="font-semibold text-sm text-[#3d2a22]">${judul}</div>
              <p class="text-xs text-[#6b5f55]">${deskripsi}</p>
            </div>
          </div>
        `;
          })
          .join("");
      }

      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.remove("hidden");
        toast.classList.add("opacity-100");
        setTimeout(() => {
          toast.classList.add("hidden");
        }, 2500);
      }

      // ========= RENDER LAPORAN =========

      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      const reportContainer = document.getElementById("reportContainer");
      const storedInspeksi = JSON.parse(
        localStorage.getItem("sekn_inspeksiData") || "null"
      );
      const inspeksiList = storedInspeksi || defaultInspeksi;
      const task = inspeksiList.find((item) => item.id === id);
      const detail = laporanDetail[id];

      if (!id || !task || !detail) {
        reportContainer.innerHTML = `
        <div class="bg-[#fffaf3] rounded-xl border border-[#e0d6cc] px-6 py-8 text-center">
          <p class="text-sm text-red-600 font-semibold mb-3">Laporan tidak ditemukan.</p>
          <p class="text-xs text-[#6b5f55] mb-5">
            Pastikan URL sudah benar atau kembali ke halaman daftar task validator.
          </p>
          <a href="index.html" class="inline-block px-4 py-2 bg-[#b06a3c] text-white text-sm font-semibold rounded-md hover:bg-[#a05d2f]">
            Kembali ke Panel Validator
          </a>
        </div>
      `;
      } else {
        const statusInfo = getStatusLabel(task.status);
        const riskInfo = getRiskLabel(task.risiko || "Sedang");

        document.getElementById(
          "reportTitle"
        ).textContent = `Laporan Inspeksi — ${task.produk}`;
        document.getElementById(
          "reportSubtitle"
        ).textContent = `Detail hasil pengecekan untuk ${task.produk} oleh mitra ${task.mitra}.`;

        reportContainer.innerHTML = `
        <!-- Ringkasan atas -->
        <section class="bg-[#fffaf3] rounded-xl shadow p-5 mb-6">
          <div class="flex flex-col sm:flex-row gap-4">
            <img src="${task.gambar}" alt="${
          task.produk
        }" class="w-full sm:w-40 h-32 object-cover rounded-lg">
            <div class="flex-1">
              <h1 class="text-lg sm:text-xl font-bold text-[#3d2a22] mb-1">
                ${task.produk}
              </h1>
              <p class="text-xs text-[#6b5f55] mb-1">
                Nomor laporan:
                <span class="font-semibold text-[#3d2a22]">${
                  detail.nomorLaporan
                }</span>
              </p>
              <p class="text-xs text-[#6b5f55] mb-1">
                Tanggal inspeksi:
                <span class="font-semibold text-[#3d2a22]">${
                  detail.tanggal
                }</span>
              </p>
              <p class="text-xs text-[#6b5f55] mb-1">
                Penjual:
                <span class="font-semibold text-[#3d2a22]">${
                  detail.penjual
                }</span>
              </p>
              <p class="text-xs text-[#6b5f55] mb-3">
                Mitra verifikasi:
                <span class="font-semibold text-[#3d2a22]">${task.mitra}</span>
              </p>

              <div class="flex flex-wrap items-center gap-2">
                <span class="badge-pill px-3 py-1 text-[11px] font-semibold ${
                  statusInfo.class
                }">
                  Status: ${statusInfo.text}
                </span>
                <span class="badge-pill px-3 py-1 text-[11px] font-semibold bg-[#f3e3d7] text-[#b06a3c]">
                  Grade final: ${detail.gradeFinal}
                </span>
                <span class="badge-pill px-3 py-1 text-[11px] font-semibold bg-white border border-[#e0d6cc] text-[#3d2a22] flex items-center gap-1">
                  <span class="inline-block w-2 h-2 rounded-full ${
                    riskInfo.dot
                  }"></span>
                  ${riskInfo.text}
                </span>
                <span class="badge-pill px-3 py-1 text-[11px] font-semibold ${
                  task.badge
                    ? "bg-green-50 text-green-700 border border-green-100"
                    : "bg-[#fffaf3] text-[#6b5f55] border border-[#e0d6cc]"
                }">
                  ${
                    task.badge
                      ? "Badge resmi sudah terbit"
                      : "Belum ada badge resmi"
                  }
                </span>
              </div>
            </div>
          </div>

          <p class="mt-4 text-sm text-[#3d2a22]">
            ${detail.catatanUmum}
          </p>
        </section>

        <!-- Grid 2 kolom -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
          <!-- Kolom kiri: Checklist fisik & fungsi -->
          <div class="lg:col-span-2 space-y-5">
            <div class="bg-[#fffaf3] rounded-xl shadow p-5">
              <h2 class="text-sm font-semibold text-[#3d2a22] mb-3">Checklist Fisik</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                ${renderChecklist(detail.checklistFisik)}
              </div>
            </div>

            <div class="bg-[#fffaf3] rounded-xl shadow p-5">
              <h2 class="text-sm font-semibold text-[#3d2a22] mb-3">Tes Fungsional</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                ${renderChecklist(detail.checklistFungsi)}
              </div>
            </div>
          </div>

          <!-- Kolom kanan: Ringkasan + Dokumentasi -->
          <div class="space-y-5">
            <div class="bg-[#fffaf3] rounded-xl shadow p-5">
              <h2 class="text-sm font-semibold text-[#3d2a22] mb-3">Ringkasan & Rekomendasi</h2>
              <p class="text-xs text-[#6b5f55] mb-2">
                Rekomendasi final:
              </p>
              <p class="text-sm font-semibold text-[#3d2a22] mb-3">
                ${detail.rekomendasi}
              </p>
              <p class="text-xs text-[#6b5f55]">
                Catatan ini bersifat simulasi untuk prototipe SEKN dan belum mewakili keputusan verifikasi sebenarnya.
              </p>
            </div>

            <div class="bg-[#fffaf3] rounded-xl shadow p-5">
              <h2 class="text-sm font-semibold text-[#3d2a22] mb-3">Dokumentasi Visual</h2>
              <ul class="list-disc list-inside text-xs text-[#3d2a22] space-y-1">
                ${detail.dokumentasi.map((item) => `<li>${item}</li>`).join("")}
              </ul>
              <p class="text-[11px] text-[#6b5f55] mt-3">
                *Pada produk nyata, bagian ini bisa berisi thumbnail foto sebelum-sesudah, IMEI screen, dan bukti tes fungsi.
              </p>
            </div>

            <div class="bg-[#fffaf3] rounded-xl shadow p-5">
              <h2 class="text-sm font-semibold text-[#3d2a22] mb-2">Catatan Tambahan Inspektor</h2>
              <p class="text-xs text-[#3d2a22]">
                ${detail.catatanTambahan}
              </p>
            </div>
          </div>
        </section>

        <!-- Timeline singkat -->
        <section class="bg-[#fffaf3] rounded-xl shadow p-5 mb-8">
          <h2 class="text-sm font-semibold text-[#3d2a22] mb-3">Riwayat Singkat Proses</h2>
          <ol class="text-xs text-[#3d2a22] space-y-1">
            <li>1. Barang diterima oleh mitra verifikasi (${task.mitra}).</li>
            <li>2. Pengecekan fisik & fungsi dilakukan sesuai checklist standar SEKN.</li>
            <li>3. Hasil dicatat pada sistem, termasuk foto pendukung & catatan teknis.</li>
            <li>4. Grade akhir ditentukan berdasarkan temuan dan usia pakai.</li>
            <li>5. (Opsional) Badge resmi SEKN diterbitkan jika memenuhi kriteria.</li>
          </ol>
        </section>

        <!-- Aksi navigasi -->
        <section class="flex flex-col sm:flex-row gap-3 sm:justify-between sm:items-center mb-4">
          <div class="text-[11px] text-[#6b5f55]">
            Halaman ini hanya simulasi frontend. Tidak ada data yang benar-benar dikirim ke server.
          </div>
          <div class="flex gap-2">
            <a href="index.html"
               class="px-4 py-2 bg-white border border-[#e0d6cc] text-[#3d2a22] text-sm font-semibold rounded-md hover:bg-[#f1ece6]">
              ← Kembali ke Daftar
            </a>
            <a href="badge.html?id=${id}"
               class="px-4 py-2 bg-[#b06a3c] text-white text-sm font-semibold rounded-md hover:bg-[#a05d2f]">
              Lanjut ke Pengelolaan Badge
            </a>
          </div>
        </section>
      `;
      }

      // ========= LOGIN UI (SHARED) =========
      const user = JSON.parse(localStorage.getItem("user"));
      const authArea = document.getElementById("authArea");

      if (user) {
        authArea.innerHTML = `
        <span class="text-[#3d2a22] font-semibold">Hi, ${user.nama}</span>
        <button onclick="logout()" class="text-[#b06a3c] underline ml-2">Logout</button>
      `;
      } else {
        authArea.innerHTML = `<a href="../login.html" class="text-[#b06a3c] underline">Login</a>`;
      }

      function logout() {
        localStorage.removeItem("user");
        window.location.href = "../login.html";
      }
    </script>
  </body>
</html>
